# dihouse-server
diHouse is smart house application built on top of server (RabbitMQ, InfluxDB, Python, STM32+NRF24L01) and clients (STM32+NRF24L01)

### Architecture

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBSRkIgLS0-IE5SRlxuICAgIE5SRiAtLT4gUkZCXG5cbiAgICBzdWJncmFwaCBDbGllbnRcbiAgICBOUkZbXCJOUkYyNEwwMVwiXSAtLT4gU1RNW1wiU1RNMzJcIl1cbiAgICBTVE0gLS0-IE5SRlxuICAgIFNbXCJTZW5zb3JzXCJdIC0tPiBTVE1cbiAgICBTVE0gLS0-IENbXCJDb250cm9sc1wiXVxuICAgIGVuZFxuXG4gICAgc3ViZ3JhcGggU2VydmVyXG4gICAgVE0oKFwiVG9waWMgbWVzaFwiKSkgLS0gQWxsIE1zZyAtLT4gIFFDKFtxdWV1ZV0pXG4gICAgUUMgLS0-IENQW1wiQ2FwdHVyZUFsbFwiXVxuICAgIENQIC0tPiBEQlsoRGF0YWJhc2UpXVxuICAgIFRNIC0tIE5vbiBSRiBNc2cgLS0-IFJGQltcIlJGQnJpZGdlXCJdXG4gICAgUkZCIC0tIFJGIE1zZyAtLT4gVE1cbiAgICBlbmRcblxuICAgIHN0eWxlIENQIGZpbGw6IzBhMFxuICAgIHN0eWxlIFJGQiBmaWxsOiMwYTBcbiAgICBzdHlsZSBEQiBmaWxsOiNkZDBcbiAgICBzdHlsZSBUTSBmaWxsOiNmZmZcblx0XHRcdFx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBSRkIgLS0-IE5SRlxuICAgIE5SRiAtLT4gUkZCXG5cbiAgICBzdWJncmFwaCBDbGllbnRcbiAgICBOUkZbXCJOUkYyNEwwMVwiXSAtLT4gU1RNW1wiU1RNMzJcIl1cbiAgICBTVE0gLS0-IE5SRlxuICAgIFNbXCJTZW5zb3JzXCJdIC0tPiBTVE1cbiAgICBTVE0gLS0-IENbXCJDb250cm9sc1wiXVxuICAgIGVuZFxuXG4gICAgc3ViZ3JhcGggU2VydmVyXG4gICAgVE0oKFwiVG9waWMgbWVzaFwiKSkgLS0gQWxsIE1zZyAtLT4gIFFDKFtxdWV1ZV0pXG4gICAgUUMgLS0-IENQW1wiQ2FwdHVyZUFsbFwiXVxuICAgIENQIC0tPiBEQlsoRGF0YWJhc2UpXVxuICAgIFRNIC0tIE5vbiBSRiBNc2cgLS0-IFJGQltcIlJGQnJpZGdlXCJdXG4gICAgUkZCIC0tIFJGIE1zZyAtLT4gVE1cbiAgICBlbmRcblxuICAgIHN0eWxlIENQIGZpbGw6IzBhMFxuICAgIHN0eWxlIFJGQiBmaWxsOiMwYTBcbiAgICBzdHlsZSBEQiBmaWxsOiNkZDBcbiAgICBzdHlsZSBUTSBmaWxsOiNmZmZcblx0XHRcdFx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)

### RabbitMQ setup

	sudo service rabbitmq-server start

After installation enable rabbitmq_management plugin to access RabbitMQ management web site via http://{server}:15672

	rabbitmq-plugins enable rabbitmq_management

Change mnesia and log location 
	sudo vim /etc/rabbitmq/rabbitmq-env.conf

	RABBITMQ_MNESIA_BASE=/mnt/HDD/dihouse/rabbitmq
	RABBITMQ_LOG_BASE=/mnt/HDD/dihouse/rabbitmq/log

Add user to use management web site

	sudo rabbitmqctl add_user dihouse dihouse
	sudo rabbitmqctl set_user_tags dihouse administrator
