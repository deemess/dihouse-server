# dihouse-server
diHouse is smart house application built on top of server (RabbitMQ, InfluxDB, Python, STM32+NRF24L01) and clients (STM32+NRF24L01)

### Architecture

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBSRlRNKChcIlJGIFRvcGljIG1lc2hcIikpXG4gICAgUkZCIC0tPiBSRlRNXG4gICAgUkZUTSAtLT4gUkZCXG4gICAgTlJGMSAtLT4gUkZUTVxuICAgIFJGVE0gLS0-IE5SRjFcbiAgICBOUkYyIC0tPiBSRlRNXG4gICAgUkZUTSAtLT4gTlJGMlxuXG4gICAgc3ViZ3JhcGggQ2xpZW50IDFcbiAgICBOUkYxW1wiTlJGMjRMMDFcIl0gLS0-IFNUTTFbXCJTVE0zMlwiXVxuICAgIFNUTTEgLS0-IE5SRjFcbiAgICBTMVtcIlNlbnNvcnNcIl0gLS0-IFNUTTFcbiAgICBTVE0xIC0tPiBDMVtcIkNvbnRyb2xzXCJdXG4gICAgZW5kXG5cbiAgICBzdWJncmFwaCBDbGllbnQgMlxuICAgIE5SRjJbXCJOUkYyNEwwMVwiXSAtLT4gU1RNMltcIlNUTTMyXCJdXG4gICAgU1RNMiAtLT4gTlJGMlxuICAgIFMyW1wiU2Vuc29yc1wiXSAtLT4gU1RNMlxuICAgIFNUTTIgLS0-IEMyW1wiQ29udHJvbHNcIl1cbiAgICBlbmRcblxuICAgIHN1YmdyYXBoIFNlcnZlclxuICAgIFRNKChcIlRvcGljIG1lc2hcIikpIC0tIEFsbCBNc2cgLS0-ICBRQyhbcXVldWVdKVxuICAgIFFDIC0tPiBDUFtcIkNhcHR1cmVBbGxcIl1cbiAgICBDUCAtLT4gREJbKERhdGFiYXNlKV1cbiAgICBUTSAtLSBOb24gUkYgTXNnIC0tPiBSRkJbXCJSRkJyaWRnZVwiXVxuICAgIFJGQiAtLSBSRiBNc2cgLS0-IFRNXG4gICAgZW5kXG5cbiAgICBzdHlsZSBDUCBmaWxsOiMwYTBcbiAgICBzdHlsZSBSRkIgZmlsbDojMGEwXG4gICAgc3R5bGUgREIgZmlsbDojZGQwXG4gICAgc3R5bGUgVE0gZmlsbDojZmZmXG4gICAgc3R5bGUgUkZUTSBmaWxsOiNmZmZcblx0XHRcdFx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBSRlRNKChcIlJGIFRvcGljIG1lc2hcIikpXG4gICAgUkZCIC0tPiBSRlRNXG4gICAgUkZUTSAtLT4gUkZCXG4gICAgTlJGMSAtLT4gUkZUTVxuICAgIFJGVE0gLS0-IE5SRjFcbiAgICBOUkYyIC0tPiBSRlRNXG4gICAgUkZUTSAtLT4gTlJGMlxuXG4gICAgc3ViZ3JhcGggQ2xpZW50IDFcbiAgICBOUkYxW1wiTlJGMjRMMDFcIl0gLS0-IFNUTTFbXCJTVE0zMlwiXVxuICAgIFNUTTEgLS0-IE5SRjFcbiAgICBTMVtcIlNlbnNvcnNcIl0gLS0-IFNUTTFcbiAgICBTVE0xIC0tPiBDMVtcIkNvbnRyb2xzXCJdXG4gICAgZW5kXG5cbiAgICBzdWJncmFwaCBDbGllbnQgMlxuICAgIE5SRjJbXCJOUkYyNEwwMVwiXSAtLT4gU1RNMltcIlNUTTMyXCJdXG4gICAgU1RNMiAtLT4gTlJGMlxuICAgIFMyW1wiU2Vuc29yc1wiXSAtLT4gU1RNMlxuICAgIFNUTTIgLS0-IEMyW1wiQ29udHJvbHNcIl1cbiAgICBlbmRcblxuICAgIHN1YmdyYXBoIFNlcnZlclxuICAgIFRNKChcIlRvcGljIG1lc2hcIikpIC0tIEFsbCBNc2cgLS0-ICBRQyhbcXVldWVdKVxuICAgIFFDIC0tPiBDUFtcIkNhcHR1cmVBbGxcIl1cbiAgICBDUCAtLT4gREJbKERhdGFiYXNlKV1cbiAgICBUTSAtLSBOb24gUkYgTXNnIC0tPiBSRkJbXCJSRkJyaWRnZVwiXVxuICAgIFJGQiAtLSBSRiBNc2cgLS0-IFRNXG4gICAgZW5kXG5cbiAgICBzdHlsZSBDUCBmaWxsOiMwYTBcbiAgICBzdHlsZSBSRkIgZmlsbDojMGEwXG4gICAgc3R5bGUgREIgZmlsbDojZGQwXG4gICAgc3R5bGUgVE0gZmlsbDojZmZmXG4gICAgc3R5bGUgUkZUTSBmaWxsOiNmZmZcblx0XHRcdFx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)

### RabbitMQ setup

	sudo service rabbitmq-server start

After installation enable rabbitmq_management plugin to access RabbitMQ management web site via http://{server}:15672

	rabbitmq-plugins enable rabbitmq_management

Change mnesia and log location 
	sudo vim /etc/rabbitmq/rabbitmq-env.conf

	RABBITMQ_MNESIA_BASE=/mnt/HDD/dihouse/rabbitmq
	RABBITMQ_LOG_BASE=/mnt/HDD/dihouse/rabbitmq/log

Add user to use management web site

	sudo rabbitmqctl add_user dihouse dihouse
	sudo rabbitmqctl set_user_tags dihouse administrator
